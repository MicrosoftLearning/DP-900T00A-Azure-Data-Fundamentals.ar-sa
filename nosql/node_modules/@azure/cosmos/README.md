---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050068"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>مكتبة عميل Azure Cosmos DB لـJavaScript/TypeScript

[![latest npm badge](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![Build Status](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB هي قاعدة بيانات متعددة النماذج موزعة عالميًا تدعم الوثائق والقيم المفتاحية والعمود العريض وقواعد البيانات الرسومية. هذه الحزمة مخصصة لتطبيقات JavaScript/Typescript للتفاعل مع قواعد بيانات **API SQL** ومستندات JSON التي تحتوي عليها:

- إنشاء قواعد بيانات قاعدة بيانات Cosmos وتعديل إعداداتها
- إنشاء حاويات وتعديلها لتخزين مجموعات مستندات JSON
- إنشاء العناصر (مستندات JSON) وقراءتها وتحديثها وحذفها في الحاويات الخاصة بك
- الاستعلام عن المستندات في قاعدة البيانات باستخدام بناء جملة يشبه SQL

الروابط الرئيسية:

- [الحزمة (npm)][npm]
- [الوثائق المرجعية لواجهة برمجة التطبيقات](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [وثائق المنتج][cosmos_docs]

## <a name="getting-started"></a>الشروع في العمل

### <a name="prerequisites"></a>المتطلبات الأساسية

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>حساب Azure Subscription وCosmos DB SQL API

يجب أن يكون لديك [اشتراك Azure][azure_sub][وحساب Cosmos DB][cosmos_account] (SQL API) لاستخدام هذه الحزمة.

إذا كنت بحاجة إلى حساب واجهة برمجة تطبيقات Cosmos DB SQL، فيمكنك استخدام Azure [Cloud Shell][cloud_shell_bash] لإنشاء حساب باستخدام أمر Azure CLI هذا:

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

أو يمكنك إنشاء حساب في [مدخل Microsoft Azure](https://portal.azure.com/#create/microsoft.documentdb)

#### <a name="nodejs"></a>NodeJS

يتم توزيع هذه الحزمة عبر [npm][npm] والتي تأتي مثبتة مسبقًا مع [NodeJS.](https://nodejs.org/en/) يجب أن تستخدم Node v10 أو أعلى.

#### <a name="cors"></a>كورس

تحتاج إلى إعداد قواعد [مشاركة الموارد عبر الأصل (CORS)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) لحساب قاعدة بيانات Cosmos الخاص بك إذا كنت بحاجة إلى التطوير للمتصفحات. اتبع الإرشادات الواردة في المستند المرتبط لإنشاء قواعد CORS جديدة لقاعدة بيانات Cosmos الخاصة بك.

### <a name="install-this-package"></a>تثبيت هذه الحزمة

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>الحصول على بيانات اعتماد الحساب

ستحتاج إلى **نقطة نهاية** **ومفتاح** حساب Cosmos DB. يمكنك العثور عليها في [مدخل Azure](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) أو استخدام مقتطف [Azure CLI][azure_cli] أدناه. يُنسق المقتطف لـBash shell.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>قم بإنشاء مثيل لـ `CosmosClient`

يبدأ التفاعل مع قاعدة بيانات Cosmos بمثيل من فئة [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

من أجل البساطة، قمنا بتضمين `key` و`endpoint` مباشرة في التعليمات البرمجية ولكن من المحتمل أن ترغب في تحميلها من ملف غير موجود في التحكم في المصدر باستخدام مشروع مثل [dotenv](https://www.npmjs.com/package/dotenv) أو التحميل من متغيرات البيئة

في بيئات الإنتاج، يجب تخزين أسرار مثل المفاتيح في [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)

## <a name="key-concepts"></a>المفاهيم الرئيسية

بمجرد تهيئة CosmosClient، يمكنك التفاعل مع أنواع الموارد الأساسية في قاعدة بيانات [Cosmos](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates):

- [قاعدة البيانات](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest): حساب Cosmos DB يمكن أن يحتوي على قواعد بيانات متعددة. عندما تنشئ قاعدة بيانات فأنت تحدد واجهة برمجة التطبيقات التي تريد استخدامها عندما تتعامل مع هذه الوثائق: SQL, MongoDB, Gremlin, Cassandra, أو Azure Table. استخدم كائن [قاعدة البيانات](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) لإدارة حاوياته.

- [حاوية](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest): الحاوية هي مجموعة من وثائق JSON. إنشاء (إدراج) وقراءة وتحديث وحذف العناصر في حاوية باستخدام أساليب على كائن [الحاوية](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [العنصر](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): العنصر هو مستند JSON مخزن في حاوية. يجب أن يتضمن كل عنصر مفتاح `id` بقيمة تحدد العنصر داخل الحاوية بشكل فريد. إذا لم تقم بتوفير `id`، فستقوم SDK بإنشاء واحد تلقائيًا.

لمزيد من المعلومات حول هذه الموارد، راجع [استخدام قواعد بيانات Azure Cosmos والحاويات والعناصر][cosmos_resources].

## <a name="examples"></a>أمثلة

توفر الأقسام التالية العديد من مقتطفات التعليمات البرمجية التي تغطي بعض مهام قاعدة بيانات Cosmos الأكثر شيوعًا، بما في ذلك:

- [إنشاء قاعدة بيانات](#create-a-database)
- [إنشاء حاوية](#create-a-container)
- [إدراج العناصر](#insert-items)
- [الاستعلام عن المستندات](#query-the-database)
- [قراءة عنصر](#read-an-item)
- [حذف عنصر](#delete-an-data)

### <a name="create-a-database"></a>إنشاء قاعدة بيانات

بعد مصادقة [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)، يمكنك العمل مع أي مورد في الحساب. ينشئ مقتطف التعليمات البرمجية أدناه قاعدة بيانات واجهة برمجة تطبيقات SQL.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>إنشاء حاوية

ينشئ هذا المثال حاوية بإعدادات افتراضية

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>إدراج العناصر

لإدراج عناصر في حاوية، مرر كائنًا يحتوي على بياناتك إلى [Items.upsert.](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-) تتطلب خدمة قاعدة بيانات Cosmos أن يكون لكل عنصر مفتاح `id`. إذا لم تقم بتوفير واحد، فستقوم SDK بإنشاء `id` تلقائيًا.

يدرج هذا المثال عدة عناصر في الحاوية

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>قراءة عنصر

لقراءة عنصر واحد من حاوية، استخدم [Item.read.](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-) هذه عملية أقل تكلفة من استخدام SQL للاستعلام عن طريق `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>حذف عنصر

لحذف عناصر من حاوية، استخدم [Item.delete.](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-)

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>الاستعلام عن قاعدة البيانات

تدعم قاعدة بيانات Cosmos DB SQL API الاستعلام عن العناصر الموجودة في حاوية باستخدام [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) باستخدام بناء جملة يشبه SQL:

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

تنفيذ استعلامات المعلمات عن طريق تمرير كائن يحتوي على المعلمات وقيمها إلى [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-):

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

لمزيد من المعلومات حول الاستعلام عن قواعد بيانات قاعدة بيانات Cosmos باستخدام واجهة برمجة تطبيقات SQL، راجع [الاستعلام عن بيانات قاعدة بيانات Azure Cosmos باستخدام استعلامات SQL][cosmos_sql_queries].

## <a name="troubleshooting"></a>استكشاف الأخطاء وإصلاحها

### <a name="general"></a>عام

عند التفاعل مع أخطاء قاعدة بيانات Cosmos التي تم إرجاعها بواسطة الخدمة تتوافق مع نفس رموز حالة HTTP التي تم إرجاعها لطلبات واجهة برمجة تطبيقات REST:

[رموز حالة HTTP لـ Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>النزاعات

على سبيل المثال، إذا حاولت إنشاء عنصر باستخدام عنصر `id` قيد الاستخدام بالفعل في قاعدة بيانات Cosmos DB، يتم إرجاع خطأ `409`، يشير إلى التعارض. في المثال التالي، تتم معالجة الخطأ على نحو آمن من خلال معرفة الاستثناء وعرض معلومات إضافية حول الخطأ.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>تحويل الشفرات

تم تصميم Azure SDKs لدعم بناء جملة ES5 JavaScript [وإصدارات LTS من Node.js](https://nodejs.org/about/releases/). إذا كنت بحاجة إلى دعم لأوقات تشغيل JavaScript السابقة مثل Internet Explorer أو Node 6، فستحتاج إلى نقل التعليمات البرمجية لحزمة SDK كجزء من عملية الإنشاء.

### <a name="handle-transient-errors-with-retries"></a>التعامل مع الأخطاء العابرة مع عمليات إعادة المحاولة

في أثناء العمل مع Cosmos DB، قد تواجه حالات فشل عابرة بسبب [حدود المعدل][cosmos_request_units] التي تفرضها الخدمة، أو مشكلات عابرة أخرى مثل انقطاع الشبكة. للحصول على معلومات حول معالجة هذه الأنواع من الأعطال، راجع [نمط إعادة المحاولة][azure_pattern_retry] في دليل أنماط تصميم السحابة، و[نمط قاطع الدائرة][azure_pattern_circuit_breaker] ذي الصلة.

## <a name="next-steps"></a>الخطوات التالية

### <a name="more-sample-code"></a>المزيد من نماذج التعليمات البرمجية

تتوفر لك [عدة عينات][cosmos_samples] في مستودع SDK GitHub. توفر هذه العينات أمثلة على التعليمات البرمجية للسيناريوهات الإضافية التي تتم مواجهتها عادة في أثناء العمل مع Cosmos DB:

- عمليات قاعدة البيانات
- عمليات الحاوية
- عمليات العنصر
- تكوين الفهرسة
- قراءة موجز تغيير حاوية
- الإجراءات المخزنة
- تغيير إعدادات معدل النقل قاعدة البيانات/الحاوية
- عمليات الكتابة متعددة المناطق

### <a name="additional-documentation"></a>وثائق إضافية

للحصول على وثائق أكثر شمولًا حول خدمة قاعدة بيانات Cosmos، راجع [وثائق قاعدة بيانات Azure Cosmos][cosmos_docs] على docs.microsoft.com.

## <a name="useful-links"></a>روابط مفيدة

- [مرحبًا بكم في قاعدة بيانات Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [بداية سريعة](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [برنامج تعليمي](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [عينات](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [مقدمة حول نموذج الموارد لخدمة Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [مقدمة حول واجهة برمجة التطبيقات SQL لخدمة قاعدة بيانات Azure Cosmos](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [التقسيم](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [مستندات API](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>المساهمة

إذا كنت ترغب في المساهمة في هذه المكتبة، يرجى قراءة [دليل المساهمة](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) لمعرفة المزيد حول كيفية إنشاء التعليمات البرمجية واختبارها.

![مرات الظهور](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
