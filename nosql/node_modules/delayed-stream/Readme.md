---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052932"
---
# <a name="delayed-stream"></a>delayed-stream

يقوم بتخزين الأحداث مؤقتًا من دفق حتى تكون مستعدًا للتعامل معها.

## <a name="installation"></a>التثبيت

``` bash
npm install delayed-stream
```

## <a name="usage"></a>الاستخدام

يوضح المثال التالي كيفية كتابة خادم صدى http الذي يؤخر استجابته بمقدار 1000 مللي ثانية.

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

إذا كنت لا تستخدم `Stream#pipe`، يمكنك أيضًا تحرير الأحداث المخزن مؤقتًا يدويًا عن طريق الاتصال `delayedStream.resume()`:

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>التنفيذ

من أجل استخدام هذا البث التعريفي بشكل صحيح، إليك بعض الأشياء التي يجب أن تعرفها عن التنفيذ.

### <a name="event-buffering--proxying"></a>التخزين المؤقت للأحداث/البروكسي

يتم اختطاف جميع أحداث الدفق `source` عن طريق تجاوز الطريقة `source.emit`. حتى تنفذ العقدة مستمعًا للأحداث الشاملة، فهذه هي الطريقة الوحيدة.

ومع ذلك، لا يزال البث المتأخر مستمرًا في إصدار جميع الأحداث التي يلتقطها على `source`، بغض النظر عما إذا كنت قد أصدرت البث المتأخر بعد أم لا.

عند الإنشاء، يلتقط البث المتأخر جميع أحداث `source` ويخزنها في مخزن مؤقت داخلي للأحداث. بمجرد استدعاء `delayedStream.release()`، يتم إصدار كافة الأحداث المخزن مؤقتًا على `delayedStream`، ويتم مسح المخزن المؤقت للأحداث. بعد ذلك، يعمل البث المتأخر فقط كوكيل للمصدر الأساسي.

### <a name="error-handling"></a>معالجة الأخطاء

يتم تخزين أحداث الخطأ `source` مؤقتًا / تقريبها تمامًا مثل أي أحداث أخرى.
ومع ذلك، `delayedStream.create` يعلق مستمع `'error'` ليس للعمليات على `source`. بهذه الطريقة عليك فقط التعامل مع الأخطاء على الكائن `delayedStream`، بدلًا من مكانين.

### <a name="buffer-limits"></a>حدود المخزن المؤقت

يوفر البث المتأخر خاصية `maxDataSize` يمكن استخدامها للحد من كمية البيانات التي يتم تخزينها مؤقتًا. من أجل حمايتك من تدفقات `source` السيئة التي لا تتفاعل مع `source.pause()`، يتم تمكين هذه الميزة افتراضيًا.

## <a name="api"></a>واجهة برمجة التطبيقات (API) 

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

يرجع ملف جديد `delayedStream`. الخيارات المتاحة هي:

* `pauseStream`
* `maxDataSize`

يمكن العثور على وصف هذه الخواص أدناه.

### <a name="delayedstreamsource"></a>delayedStream.source

الدفق `source` المدار بواسطة هذا الكائن. هذا مفيد إذا كنت تقوم بتمرير `delayedStream`، وما زلت ترغب في الوصول إلى الخصائص الموجودة على الكائن `source`.

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

ما إذا كان يجب إيقاف التراكب `source` مؤقتًا عند استدعاء `DelayedStream.create()`. تعديل هذه الخاصية بعد ذلك ليس له أي تأثير.

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

كمية البيانات المراد تخزينها مؤقتًا قبل انبعاث `error`.

إذا كان المصدر السفلي ينبعث منه كائنات `Buffer`، فإن `maxDataSize` يشير إلى البايت.

إذا كان المصدر الأساسي ينبعث منه سلاسل JavaScript، فإن الحجم يشير إلى الأحرف.

إذا كنت تعرف ما تفعله، يمكنك تعيين هذه الخاصية إلى `Infinity` لتعطيل هذه الميزة. يمكنك أيضًا تعديل هذه الخاصية في أثناء وقت التشغيل.

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

كمية البيانات التي تم تخزينها مؤقتًا حتى الآن.

### <a name="delayedstreamreadable"></a>delayedStream.readable

أداة الحصول على ECMA5 التي ترجع قيمة `source.readable`.

### <a name="delayedstreamresume"></a>delayedStream.resume()

إذا لم يتم إطلاق `delayedStream` حتى الآن، يتم استدعاء `delayedStream.release()`.

في كلتا الحالتين، يتم استدعاء `source.resume()`.

### <a name="delayedstreampause"></a>delayedStream.pause()

استدعاء `source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

يستدعي `delayedStream.resume()` ثم وكلاء الوسيطات إلى `source.pipe`.

### <a name="delayedstreamrelease"></a>delayedStream.release()

ينبعث ويزيل جميع الأحداث التي تم تخزينها مؤقتًا حتى الآن. هذا لا يستأنف المصدر الأساسي، استخدم `delayedStream.resume()` بدلًا من ذلك.

## <a name="license"></a>الترخيص

يتم ترخيص البث المشترك بموجب ترخيص معهد ماساتشوستس للتكنولوجيا.
