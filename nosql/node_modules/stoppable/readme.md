---
ms.openlocfilehash: 03ad292b1fceecb8974f1d8753cb47723344dbf3
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050080"
---
# <a name="stoppable"></a>Stoppable

[![Build Status](https://travis-ci.org/hunterloftis/stoppable.svg?branch=master)](https://travis-ci.org/hunterloftis/stoppable)

> `server.close()` العقدة هي الطريقة التي ربما [توقعت أن تعمل بها افتراضيًا](https://github.com/nodejs/node/issues/2642).

## <a name="summary"></a>الملخص

```js
const server = stoppable(http.createServer(handler))
server.stop()
```

يتوقف Stoppable عن قبول اتصالات جديدة ويغلق الاتصالات الحالية الخاملة (بما في ذلك إبقاء ما يعمل) دون إنهاء الطلبات الموجودة في أثناء الطيران.

## <a name="requirements"></a>المتطلبات

- Node.js v6+

Node.js v4.x مدعوم *بشكل غير رسمي*.

## <a name="installation"></a>التثبيت

```bash
yarn add stoppable
```

(أو استخدام npm)

## <a name="usage"></a>الاستخدام

**constructor**

```js
stoppable(server, grace)
```

تزيين مثيل الخادم بطريقة `stop`.
إرجاع مثيل الخادم، بحيث يمكن ربطه بالسلاسل، أو يمكن تشغيله كعبارة مستقلة.

- الخادم: أي مثيل خادم HTTP أو HTTPS
- السماح: انتظار بعض المللي ثانية قبل إنهاء الاتصالات عنوة

`grace` الإعدادات الافتراضية إلى Infinity (لا تفرض الإغلاق).
إذا كنت ترغب في إنهاء جميع المقابس على الفور، فيمكنك استخدام سماح 0.

**stop()**

```js
server.stop(callback)
```

يغلق الخادم.

- معاودة الاتصال: تم تمريرها إلى الوظيفة `server.close` الحالية لتسجيل حدث "إغلاق" تلقائيًا.
الوسيطة الأولى هي الخطأ، والوسيطة الثانية هي منطقية تشير إلى ما إذا كانت قد توقفت في وقت السماح.

## <a name="design-decisions"></a>قرارات التصميم

- ترقيع القرود بشكل عام سيئ، ولكن في هذه الحالة يكون أجمل واجهة برمجة تطبيقات. دعونا نسميها "تزيين".
- `grace` يمكن تحديده على `stop`، ولكن من الأفضل مطابقة واجهة برمجة التطبيقات الحالية `server.close`.
- يجب التعامل مع العملاء باحترام، لذلك نحن لا ندمر المقابس فحسب، بل نرسل حزم `FIN` أولًا.
- يتطلب أي حل لهذه المشكلة مسك الدفاتر على كل اتصال وطلب / استجابة.
نحن نقوم بالحد الأدنى من العمل على مسارات التعليمات البرمجية "الساخنة" هذه ونؤخر قدر الإمكان إلى الطريقة `stop` الفعلية.

## <a name="performance"></a>الأداء

لا توجد طريقة لتوفير هذه الوظيفة دون مسك الدفاتر عند الاتصال وقطع الاتصال والطلب والاستجابة.
ومع ذلك، تسعى Stoppable جاهدة للقيام بالحد الأدنى من العمل في مسارات التعليمات البرمجية الساخنة واستخدام هياكل البيانات المثلى.

سأكون مهتمًا برؤية معايير الأداء في العالم الحقيقي. يظهر معيار المدفعية الارتدادي البسيط المضمن في lib القليل جدًا من النفقات العامة من استخدام خادم قابل للإيقاف:

### <a name="without-stoppable"></a>بدون Stoppable

```plain
  Scenarios launched:  10000
  Scenarios completed: 10000
  Requests completed:  10000
  RPS sent: 939.85
  Request latency:
    min: 0.5
    max: 51.3
    median: 2.1
    p95: 3.7
    p99: 15.3
  Scenario duration:
    min: 1
    max: 60.7
    median: 3.6
    p95: 7.6
    p99: 19
  Scenario counts:
    0: 10000 (100%)
  Codes:
    200: 10000
```

### <a name="with-stoppable"></a>مع Stoppable

```plain
  Scenarios launched:  10000
  Scenarios completed: 10000
  Requests completed:  10000
  RPS sent: 940.73
  Request latency:
    min: 0.5
    max: 43.4
    median: 2.1
    p95: 3.8
    p99: 15.5
  Scenario duration:
    min: 1.1
    max: 57
    median: 3.7
    p95: 8
    p99: 19.4
  Scenario counts:
    0: 10000 (100%)
  Codes:
    200: 10000
```

## <a name="license"></a>الترخيص

معهد ماساتشوستس للتكنولوجيا