---
ms.openlocfilehash: 4f36d4681facd228c63b48050973040e9785d30f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/05/2022
ms.locfileid: "138049986"
---

<a name="microsoft-authentication-library-for-javascript-msaljs"></a>Microsoft Authentication Library لـJavaScript (MSAL.js)
=========================================================

| [البدء](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)| [مستندات AAD (دليل Azure النشط)](https://aka.ms/aaddevv2) | [مرجع المكتبة](https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal.html) | [الدعم](README.md#community-help-and-support) | [عينات](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)
| --- | --- | --- | --- | --- |

⚠️⚠️⚠️ لم تعد هذه المكتبة تتلقى ميزات جديدة وستتلقى فقط إصلاحات الأخطاء الهامة والأمان. يجب أن تستخدم جميع التطبيقات الجديدة [@azure/msal-browser](https://www.npmjs.com/package/@azure/msal-browser) بدلاً من ذلك. ⚠️⚠️⚠️

تمكن MSAL for JavaScript تطبيقات الويب جافا سكريبت من جانب العميل، التي تعمل في متصفح الويب، من مصادقة المستخدمين باستخدام حسابات العمل والمدرسة [Azure AD (AAD (دليل Azure النشط))](https://docs.microsoft.com/azure/active-directory/develop/v2-overview) وحسابات Microsoft الشخصية (MSA) وموفري الهوية الاجتماعية مثل Facebook وGoogle وLinkedIn وحسابات Microsoft وما إلى ذلك من خلال خدمة [Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers). كما أنه يمكن تطبيقك من الحصول على رموز مميزة للوصول إلى خدمات [Microsoft Cloud](https://www.microsoft.com/enterprise) مثل [Microsoft Graph](https://graph.microsoft.io).

[![npm version](https://img.shields.io/npm/v/msal.svg?style=flat)](https://www.npmjs.com/package/msal)
[![npm version](https://img.shields.io/npm/dm/msal.svg)](https://nodei.co/npm/msal/)
[![codecov](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js/branch/dev/graph/badge.svg?flag=msal-core)](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js)

## <a name="installation"></a>التثبيت

### <a name="via-npm"></a>عبر NPM:

    npm install msal

## <a name="via-cdn"></a>عبر شبكة تسليم المحتوى (CDN):

<!-- CDN_LATEST -->
```html
<script type="text/javascript" src="https://alcdn.msauth.net/lib/1.4.11/js/msal.min.js"></script>
```

تتوفر [التفاصيل الكاملة وأفضل الممارسات](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/docs/cdn.md) لاستخدام CDN في وثائقنا.

## <a name="what-to-expect-from-this-library"></a>ما يمكن توقعه من هذه المكتبة
دعم MSAL على جافا سكريبت هو مجموعة من المكتبات. `msal-core` أو ببساطة `msal`، هو الإطار لمكتبة أساسية في النظام الأساسي. بمجرد استقرار 1.x + الأساسي، سنجلب مكتبتنا `msal-angular` بأحدث تحسينات 1.x.  نحن نخطط لإهمال الدعم لـ`msal-angularjs` بناء على اتجاهات استخدام الإطار والمكتبة مما يشير إلى زيادة اعتماد Angular 2+ بدلاً من Angular 1x. بعد أن ترقى مكتباتنا الحالية إلى مستوى المعايير، سنبدأ في موازنة طلبات الميزات الجديدة، مع منصات جديدة مثل `react` و`node.js`.

هدفنا هو التواصل بشكل جيد للغاية مع المجتمع وأخذ آرائهم في الاعتبار. نود الوصول إلى جدول زمني شهري للإصدار البسيط، مع ظهور التصحيحات كلما دعت الحاجة.  سيكون مستوى التواصل والتخطيط والدقة التي نريد الوصول إليها عملا قيد التقدم.

يرجى مراجعة [خارطة الطريق الخاصة](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki#roadmap) بنا لمعرفة ما نعمل عليه وما نتبعه بعد ذلك.

## <a name="oauth-20-and-the-implicit-flow"></a>OAuth 2.0 and the Implicit Flow

تقوم Msal بتنفيذ [Implicit Grant Flow](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow)، كما هو محدد في بروتوكول OAuth 2.0 وهي متوافقة مع [OpenID](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc).

هدفنا هو أن تقوم المكتبة بتجريد ما يكفي من البروتوكول بعيداً حتى تتمكن من الحصول على مصادقة التوصيل والتشغيل، ولكن من المهم معرفة وفهم التدفق الضمني من منظور أمني.
يعمل التدفق الضمني في سياق متصفح الويب الذي لا يمكنه إدارة أسرار العميل بشكل آمن. تم تحسينه لتطبيقات الصفحة الواحدة ولديه قفزة واحدة أقل بين العميل والخادم بحيث يتم إرجاع الرموز المميزة مباشرة إلى المتصفح. هذه الجوانب تجعلها أقل أمانا بشكل طبيعي.
يتم تخفيف هذه المخاوف الأمنية وفقا للممارسات القياسية مثل - استخدام الرموز المميزة قصيرة العمر (وبالتالي لا يتم إرجاع رموز التحديث)، والمكتبة التي تتطلب عنوان URI مسجلاً لإعادة التوجيه للتطبيق، والمكتبة التي تطابق الطلب والاستجابة مع معلمة nonce وstate فريدة من نوعها.

## <a name="cache-storage"></a>تخزين ذاكرة التخزين المؤقت

نحن نقدم طريقتين للتخزين لـMsal، `localStorage` و`sessionStorage`.  نوصي باستخدام ⁧`sessionStorage`⁩ لأنه أكثر أمانًا في تخزين الرموز المميزة التي يتم الحصول عليها من قبل المستخدمين؛ ولكن ⁧`localStorage`⁩ سيعطيك ⁧⁩تسجيل دخول أحادي⁧⁩ عبر علامات التبويب، وجلسات المستخدم.  نحن نحثك على استكشاف الخيارات واتخاذ أفضل قرار لطلبك.

### <a name="forcerefresh-to-skip-cache"></a>forceRefresh لتخطي ذاكرة التخزين المؤقت
إذا كنت ترغب في تخطّي رمز تم تخزينه مؤقتاً والانتقال إلى الخادم، فالرجاء تمرير `forceRefresh` المنطقي في عنصر `AuthenticationParameters` المستخدم لإجراء طلب تسجيل الدخول/ الرمز المميز. **تحذير:** لا يجب استخدام هذا افتراضياً، بسبب تأثير الأداء على تطبيقك.  سيؤدي الاعتماد على ذاكرة التخزين المؤقت إلى منح المستخدمين تجربة أفضل، ويجب استخدام تخطيها فقط في السيناريوهات التي تعرف فيها أن البيانات المخزنة مؤقتاً الحالية لا تحتوي على معلومات محدثة.  مثال: أداة المسؤول التي تضيف أدواراً إلى مستخدم يحتاج إلى الحصول على رمز مميز جديد بأدوار محدّثة.

## <a name="usage"></a>الاستخدام
يرشدك المثال أدناه إلى كيفية تسجيل الدخول إلى مستخدم والحصول على رمز مميز لاستخدامه في واجهة برمجة تطبيقات Graph من Microsoft.

#### <a name="prerequisites"></a>المتطلبات الأساسية

قبل استخدام MSAL.js ستحتاج إلى [تسجيل تطبيق في Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app) للحصول على صالح `clientId` للتكوين، ولتسجيل المسارات التي سيقبل تطبيقك إعادة توجيه نسبة استخدام الشبكة عليها.

#### <a name="1-instantiate-the-useragentapplication"></a>1. 1. إنشاء تطبيق UserAgentApp

`UserAgentApplication` يمكن تكوينها مع مجموعة متنوعة من الخيارات المختلفة، مفصلة في [Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#configuration-options) لدينا، ولكن المعلمة الوحيدة المطلوبة هي `auth.clientId`.

بعد إنشاء مثيل الخاص بك، إذا كنت تخطط لاستخدام تدفق إعادة توجيه في MSAL 1.2.x أو إصدار أقدم ( `loginRedirect` و`acquireTokenRedirect`)، فيجب عليك تسجيل معالج معاودة الاتصال باستخدام `handleRedirectCallback(authCallback)` حيث `authCallback = function(AuthError, AuthResponse)`. اعتباراً من MSAL 1.3.0 هذا اختياري. يتم استدعاء وظيفة معاودة الاتصال بعد اكتمال طلب المصادقة إما بنجاح أو مع فشل. هذا غير مطلوب للتدفقات المنبثقة لأنها تعيد الوعود.

```JavaScript
    import * as Msal from "msal";
    // if using cdn version, 'Msal' will be available in the global scope

    const msalConfig = {
        auth: {
            clientId: 'your_client_id'
        }
    };

    const msalInstance = new Msal.UserAgentApplication(msalConfig);

    msalInstance.handleRedirectCallback((error, response) => {
        // handle redirect response or error
    });

```

للحصول على تفاصيل حول خيارات التكوين، اقرأ [تهيئة تطبيقات العميل باستخدام MSAL.js](https://docs.microsoft.com/azure/active-directory/develop/msal-js-initializing-client-applications).

#### <a name="2-login-the-user"></a>2. تسجيل الدخول للمستخدم

يجب أن يسجل تطبيقك دخول المستخدم باستخدام الطريقة `loginPopup` أو `loginRedirect` لإنشاء سياق المستخدم.

عند استدعاء طرق تسجيل الدخول وإكمال مصادقة المستخدم بواسطة خدمة Azure AD، يتم إرجاع [رمز مميز للمعرف](https://docs.microsoft.com/azure/active-directory/develop/id-tokens) يستخدم لتحديد هوية المستخدم ببعض المعلومات الأساسية.

عند تسجيل دخول مستخدم، يمكنك تمرير النطاقات التي يمكن للمستخدم الموافقة المسبقة عليها عند تسجيل الدخول، ولكن هذا غير مطلوب. يرجى ملاحظة أن الموافقة على النطاقات عند تسجيل الدخول، لا تعيد access_token لهذه النطاقات، ولكنها تمنحك الفرصة للحصول على رمز مميز بصمت مع تمرير هذه النطاقات، دون أي تفاعل آخر من المستخدم.

من أفضل الممارسات طلب النطاقات التي تحتاجها فقط عندما تحتاج إليها، وهو مفهوم يسمى الموافقة الديناميكية. على الرغم من أن هذا يمكن أن يخلق موافقة أكثر تفاعلية للمستخدمين في تطبيقك، إلا أنه يقلل أيضاً من تسرب من المستخدمين الذين قد يكونون غير مرتاحين لمنح قائمة كبيرة من الأذونات للميزات التي لم يستخدموها بعد.

سيسمح لك AAD (دليل Azure النشط) فقط بالحصول على موافقة على 3 موارد في المرة الواحدة، على الرغم من أنه يمكنك طلب العديد من النطاقات داخل المورد.
عندما يقدم المستخدم طلب تسجيل دخول، يمكنك تمرير موارد متعددة ونطاقاتها المقابلة لأن AAD (دليل Azure النشط) يصدر idToken موافقة مسبقة على هذه النطاقات. ومع ذلك، فإن مكالمات acquireToken صالحة فقط لمورد واحد / نطاقات متعددة. إذا كنت بحاجة إلى الوصول إلى موارد متعددة، فيرجى إجراء مكالمات acquireToken منفصلة لكل مورد.

```JavaScript
   var loginRequest = {
       scopes: ["user.read", "mail.send"] // optional Array<string>
   };

    msalInstance.loginPopup(loginRequest)
        .then(response => {
            // handle response
        })
        .catch(err => {
            // handle error
        });

```

##### <a name="ssosilent"></a>ssoSilent

إذا كنت واثقاً من أن المستخدم لديه جلسة عمل حالية ويرغب في إنشاء سياق المستخدم دون المطالبة بالتفاعل، فيمكنك استدعاء `ssoSilent` باستخدام `loginHint` أو `sid` (متوفر [كمطالبة اختيارية](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)) وستحاول MSAL الدخول الموحد (SSO) بصمت إلى الجلسة الحالية وإنشاء سياق المستخدم.

لاحظ، إذا لم تكن هناك جلسة نشطة للمعين `loginHint` أو `sid`، يتم طرح خطأ، والذي يجب معالجته عن طريق استدعاء طريقة تسجيل دخول تفاعلية (`loginPopup` أو `loginRedirect`).

مثال:

```js
const ssoRequest = {
    loginHint: "user@example.com"
};

msalInstance.ssoSilent(ssoRequest)
    .then(response => {
        // session silently established
    })
    .catch(error => {
        // handle error by invoking an interactive login method
        msalInstance.loginPopup(ssoRequest);
    });
```

#### <a name="3-get-an-access-token-to-call-an-api"></a>3. احصل على رمز مميز للوصول لاستدعاء واجهة برمجة التطبيقات

في MSAL، يمكنك الحصول على رموز الوصول المميزة لواجهات برمجة التطبيقات التي يحتاج تطبيقك إلى الاتصال بها باستخدام الطريقة `acquireTokenSilent` التي تقدم طلباً صامتاً (دون مطالبة المستخدم باستخدام واجهة المستخدم) إلى Azure AD للحصول على رمز مميز للوصول. ثم تقوم خدمة Azure AD بإرجاع [رمز مميز للوصول](https://docs.microsoft.com/azure/active-directory/develop/access-tokens) يحتوي على نطاقات وافق عليها المستخدم للسماح لتطبيقك بالاتصال بواجهة برمجة التطبيقات بشكل آمن.

يمكنك استخدام `acquireTokenRedirect` أو `acquireTokenPopup` بدء الطلبات التفاعلية، على الرغم من أنه من الأفضل إظهار التجارب التفاعلية فقط إذا كنت غير قادر على الحصول على رمز مميز بصمت بسبب أخطاء التفاعل المطلوبة. إذا كنت تستخدم مكالمة رمز مميز تفاعلية، فيجب أن تتطابق مع طريقة تسجيل الدخول المستخدمة في التطبيق الخاص بك. (`loginPopup`=> `acquireTokenPopup`, `loginRedirect` => `acquireTokenRedirect`).

إذا فشل الاستدعاء `acquireTokenSilent` بسبب خطأ من النوع `InteractionRequiredAuthError`، فستحتاج إلى بدء طلب تفاعلي.  يمكن أن يحدث هذا لأسباب عديدة بما في ذلك النطاقات التي تم إلغاؤها أو الرموز المميزة منتهية الصلاحية أو تغييرات كلمة المرور.

`acquireTokenSilent` ستبحث عن رمز مميز صالح في ذاكرة التخزين المؤقت، وإذا كان على وشك الانتهاء أو غير موجود، فسيحاول تلقائياً تحديثه نيابة عنك.

راجع [أنواع بيانات الطلب والاستجابة للرجوع](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#signing-in-and-getting-tokens-with-msaljs) إليها.

```JavaScript
    // if the user is already logged in you can acquire a token
    if (msalInstance.getAccount()) {
        var tokenRequest = {
            scopes: ["user.read", "mail.send"]
        };
        msalInstance.acquireTokenSilent(tokenRequest)
            .then(response => {
                // get access token from response
                // response.accessToken
            })
            .catch(err => {
                // could also check if err instance of InteractionRequiredAuthError if you can import the class.
                if (err.name === "InteractionRequiredAuthError") {
                    return msalInstance.acquireTokenPopup(tokenRequest)
                        .then(response => {
                            // get access token from response
                            // response.accessToken
                        })
                        .catch(err => {
                            // handle error
                        });
                }
            });
    } else {
        // user is not logged in, you will need to log them in to acquire a token
    }
```

#### <a name="4-use-the-token-as-a-bearer-in-an-http-request-to-call-the-microsoft-graph-or-a-web-api"></a>4. استخدم الرمز المميز كحامل في طلب HTTP للاتصال بـ Microsoft Graph أو واجهة برمجة تطبيقات الويب

```JavaScript
    var headers = new Headers();
    var bearer = "Bearer " + token;
    headers.append("Authorization", bearer);
    var options = {
         method: "GET",
         headers: headers
    };
    var graphEndpoint = "https://graph.microsoft.com/v1.0/me";

    fetch(graphEndpoint, options)
        .then(resp => {
             //do something with response
        });
```

يمكنك معرفة المزيد من التفاصيل حول وظائف MSAL.js موثقة في [MSAL Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) والعثور على [عينات التعليمات البرمجية](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples) الكاملة.

## <a name="security-reporting"></a>التقارير الأمنية

إذا وجدت مشكلة أمنية في مكتباتنا أو خدماتنا، فيرجى الإبلاغ عنها إلى [secure@microsoft.com](mailto:secure@microsoft.com) بأكبر قدر ممكن من التفاصيل. قد تكون عملية الإرسال الخاصة بك مؤهلة للحصول على مكافأة من خلال برنامج [Microsoft Bounty](http://aka.ms/bugbounty). يرجى عدم نشر مشكلات الأمان على GitHub المشكلات أو أي موقع عام آخر. سوف نتصل بك بمجرد تلقي المعلومات. نحن نشجعك على تلقي إشعارات عند وقوع حوادث أمنية من خلال زيارة [هذه الصفحة](https://technet.microsoft.com/security/dd252948) والاشتراك في التنبيهات الاستشارية الأمنية.

## <a name="license"></a>الترخيص

Copyright (c) Microsoft Corporation.  جميع الحقوق محفوظة. مرخص بموجب ترخيص معهد ماساتشوستس للتكنولوجيا ("الترخيص")؛

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>نحن نقدر ونلتزم بمدونة قواعد السلوك مفتوحة المصدر من Microsoft

اعتمد هذا المشروع [مدونة السلوك من المصادر المفتوحة من Microsoft.](https://opensource.microsoft.com/codeofconduct/) لمزيد من المعلومات، راجع [الأسئلة الشائعة حول مدونة قواعد السلوك](https://opensource.microsoft.com/codeofconduct/faq/) أو الاتصال بـ[opencode@microsoft.com](mailto:opencode@microsoft.com) لأي أسئلة أو تعليقات إضافية.
